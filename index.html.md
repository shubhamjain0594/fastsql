# fastsql


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Install

``` sh
pip install fastsql
```

## Creating a table

``` python
from fastsql import *
import sqlalchemy as sa
```

First we instantiate our database using FastSQL’s Database class:

``` python
db = Database("sqlite:///:memory:")
```

The main table object in FastSQL is
[`DBTable`](https://answerdotai.github.io/fastsql/core.html#dbtable),
which you can create by calling `DBTable(table)` with a SQLAlchemy
`Table` object, or by calling `Database.create(cls)` with a class
(optionally a dataclass). We’ll demonstrate the latter with these
classes:

``` python
class User: name:str; pwd:str
class Todo: title:str; name:str; id:int=None; done:bool=False; details:str=''
```

Equipped with our schemas, let’s turn them into database tables.

``` python
users = db.create(User, pk='name')
todos = db.create(Todo, pk='id')
```

Let’s confirm the table design:

``` python
print(db.schema())
```

    Table: todo
      - title: VARCHAR
      - name: VARCHAR
      * id: INTEGER
      - done: BOOLEAN
      - details: VARCHAR
    Table: user
      * name: VARCHAR
      - pwd: VARCHAR

We can check if a table exists:

``` python
users.exists()
```

    True

## Using FastSQL

Let’s create some dataclass objects representing users and todos.

``` python
u0 = User('jph','foo')
u1 = User('rlt','bar')
t0 = Todo('do it', 'jph')
t1 = Todo('build it', 'jph')
t2 = Todo('write book', 'rlt')
```

Let’s convert these dataclass objects into database records. To do that
we insert them into their tables using the aply named `insert` method:

``` python
users.insert(u0)
users.insert(u1)
todos.insert(t0)
todos.insert(t1)
todos.insert(t2)
```

    Todo(title='write book', name='rlt', id=3, done=False, details='')

To query a single table, call the table like a function (which is
implemented in Python using the special `__call__` method.

------------------------------------------------------------------------

<a
href="https://github.com/answerdotai/fastsql/blob/main/fastsql/core.py#LNone"
target="_blank" style="float:right; font-size:smaller">source</a>

### DBTable.\_\_call\_\_

>      DBTable.__call__ (where:str|None=None,
>                        where_args:Union[Iterable,dict,NoneType]=None,
>                        order_by:str|None=None, limit:int|None=None,
>                        offset:int|None=None, select:str='*', **kw)

*Result of `select` query on the table*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>where</td>
<td>str | None</td>
<td>None</td>
<td>SQL where fragment to use, for example <code>id &gt; ?</code></td>
</tr>
<tr class="even">
<td>where_args</td>
<td>Union</td>
<td>None</td>
<td>Parameters to use with <code>where</code>; iterable for
<code>id&gt;?</code>, or dict for <code>id&gt;:id</code></td>
</tr>
<tr class="odd">
<td>order_by</td>
<td>str | None</td>
<td>None</td>
<td>Column or fragment of SQL to order by</td>
</tr>
<tr class="even">
<td>limit</td>
<td>int | None</td>
<td>None</td>
<td>Number of rows to limit to</td>
</tr>
<tr class="odd">
<td>offset</td>
<td>int | None</td>
<td>None</td>
<td>SQL offset</td>
</tr>
<tr class="even">
<td>select</td>
<td>str</td>
<td>*</td>
<td>Comma-separated list of columns to select</td>
</tr>
<tr class="odd">
<td>kw</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>list</strong></td>
<td></td>
<td><strong>List of returned objects</strong></td>
</tr>
</tbody>
</table>

``` python
users()
```

    [User(name='jph', pwd='foo'), User(name='rlt', pwd='bar')]

Use where statement to filter records, in this case only jph’s todos.

``` python
todos(where="name = :name", name="jph")
```

    [Todo(title='do it', name='jph', id=1, done=False, details=''),
     Todo(title='build it', name='jph', id=2, done=False, details='')]

Look only for those records with the word `it` in it.

``` python
todos(where="title LIKE :title", title="%% it%%")
```

    [Todo(title='do it', name='jph', id=1, done=False, details=''),
     Todo(title='build it', name='jph', id=2, done=False, details='')]

You can also fetch a record just by the primary key by using `[]` with
the table:

``` python
user = users['rlt']
user
```

    User(name='rlt', pwd='bar')

Change a value in a record by updating an object, and passing the
updated object to `update()`:

``` python
user.pwd = 'baz'
users.update(user)
users['rlt']
```

    User(name='rlt', pwd='baz')

## Using SQLAlchemy

``` python
ut,uc = users.t
tt,tc = todos.t
```

``` python
query = sa.select(uc.name, uc.pwd, tc.title).select_from(
    tt.join(ut, tc.name == uc.name))
list(db.execute(query))
```

    [('jph', 'foo', 'do it'),
     ('jph', 'foo', 'build it'),
     ('rlt', 'baz', 'write book')]

``` python
dbm = db.meta
```
